# Интерфейсы и UX (Telegram Bot версия)

В этом документе описываются пользовательские сценарии и UX при взаимодействии через Telegram Bot (без Mini App). Фронтенд‑веб остаётся опциональным и служит для расширенной аналитики.

## 1. Основные сценарии в боте

### 1.1. Старт и помощь
- Пользователь запускает `/start` — бот приветствует и, при первом входе, регистрирует пользователя (по telegram_id)
- `/help` — отображает доступные команды

### 1.2. Голосование `/vote`
- Шаг 1: бот получает из backend список участников, доступных для голосования
- Шаг 2: бот показывает пользователю карточки/списки с инлайн‑кнопками оценок 0–10
- Шаг 3: пользователь выбирает оценку для каждого участника (возможен пошаговый режим)
- Шаг 4: бот отправляет `POST /api/v1/votes` c `session_id` и массивом `{target_id, score}`; при успехе — подтверждение

### 1.3. Результаты `/results`
- Бот получает `GET /api/v1/results/me` (для пользователя) или `GET /api/v1/results/session/{id}` (общий рейтинг)
- Возвращает:
  - краткий рейтинг (текст)
  - сводную карточку «моё место / средняя оценка / бонус»
  - опционально — файл XLSX/CSV по кнопке (бот прикрепляет документ)

### 1.4. Профиль `/me`
- Выводит имя, username, роль (user/admin), активность, краткую статистику (место, средняя, суммы)

## 2. Администрирование (через бот)

- Команды доступны, если роль admin (проверяется на backend):
  - `/admin_open_session` — создать новую сессию (бот уточняет дату окончания)
  - `/admin_close_session` — закрыть текущую
  - `/admin_reopen_session` — переоткрыть в течение X часов
  - `/admin_bonus` — установить параметры бонусов (пошаговый ввод: выручка, множитель, итоговая сумма)
  - `/admin_export` — выгрузить XLSX/CSV (бот отправляет как документ)

## 3. UX‑паттерны в боте

- Инлайн‑кнопки с оценками 0–10 для каждой карточки участника
- Пошаговая навигация: «назад», «пропустить», «сохранить»
- Подтверждение перед отправкой итогового набора голосов
- Защита от двойной отправки (бот хранит состояние шага)
- Сообщения об ошибках в дружелюбном формате

## 4. Веб‑интерфейс (опционально)

- Может открываться по magic‑link из бота
- Используется для просмотра расширенной аналитики, истории, экспорта
- Авторизация — по одноразовой ссылке `/auth/magic-link` (JWT с коротким TTL)

## 5. Рабочие состояния и сообщения

- Нет активной сессии — бот сообщает и предлагает подписаться на уведомление о старте
- Участник недоступен для голосов — скрыть карточку/задизейблить кнопки
- Пользователь уже голосовал — показать сводку, предложить обновить (если политика разрешает)

## 6. Локальная сеть / офлайн UX

- Бот и backend могут работать в одной локальной сети без публичного домена
- Команды и ответы работают через Telegram API (интернет всё равно нужен клиенту), но веб‑сайт не обязателен
- Magic‑link можно отключить, если веб не используется
