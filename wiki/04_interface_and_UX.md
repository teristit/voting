# 04_Интерфейсы_и_UX

## 1. Общая концепция каналов

Система предоставляет два канала взаимодействия:

1) Telegram Bot — быстрые операции для сотрудников и базовые админ-действия.
2) Веб-версия (расширенный интерфейс) — полный функционал, особенно для администраторов и аналитики.

Бот и веб используют общий backend и единые правила авторизации/ролей.

---

## 2. Веб-версия: роли и доступ

- Роли: employee, manager, admin, auditor (только чтение).
- SSO/OAuth2 (опционально) + связка с Telegram User ID.
- RBAC: каждая страница/операция защищены политиками доступа.

---

## 3. Веб: навигация и главные разделы

Левая панель навигации (для admin):
- Дашборд
- Сессии голосования
- Участники
- Голоса и корректировки
- Параметры премии
- Отчёты и экспорт
- Журнал и мониторинг
- Настройки системы

Для employee видны только: Дашборд, Мои результаты, Голосование (если активно), История.

---

## 4. Веб-дизайн: ключевые принципы UX

- Адаптивная вёрстка 1280–1920px; таблицы с горизонтальным скроллом.
- Массовые операции — через таблицы с множественным выбором и панелью действий.
- Ненавязчивая валидация форм, автосохранение черновиков.
- Фильтры с сохранением пресетов.
- «Безопасные» действия требуют подтверждения (модалки, 2-кнопочный confirm).

---

## 5. Дашборд администратора

Виджеты:
- Состояние текущей сессии (№, период, прогресс голосов, дедлайн).
- Участники: активные/в отпуске/деактивированные.
- Активность по дням (мини-гистограмма).
- Ранний прогноз фонда премий (по текущим T2/T3, если разрешено).
- Последние события журнала (из /api/v1/logs).

Быстрые действия:
- Создать/закрыть/переоткрыть сессию.
- Отправить напоминания.
- Экспорт XLSX/CSV.

---

## 6. Сессии голосования (веб)

Страницы и функции:

6.1 Список сессий
- Таблица: №, период, статус, проголосовало %, участников, фонд, действия.
- Фильтры: статус, период, отдел, автор.
- Действия: открыть/закрыть/переоткрыть, перейти к деталям, экспорт.

6.2 Детали сессии
- Вкладки: Обзор | Участники | Голоса | Параметры | Результаты | Журнал.
- Обзор: прогресс, активность по дням, список не проголосовавших (с кнопкой «Напомнить»).
- Участники: таблица + массовые операции (добавить, исключить, права).
- Голоса: матрица/таблица, фильтры, корректировки (PATCH/DELETE).
- Параметры: форма редактирования `average_weekly_revenue`, `participation_multiplier`, `total_weekly_bonus`, `participants_info`.
- Результаты: рейтинг, премии, графики распределения (boxplot/барчарт), экспорт.
- Журнал: действия по сессии (audit_log).

6.3 Мастер создания сессии (3 шага)
- Даты → Участники → Параметры премии.
- Предпросмотр и подтверждение.

---

## 7. Участники (веб)

- Таблица: ФИО, Telegram, роль, статус, отдел, участие (can_vote/receive), отметки.
- Массовые действия: назначить роль, включить/исключить, выставить статус (active/vacation), удалить.
- Импорт/экспорт пользователей (CSV/XLSX) с валидацией.
- Поиск и фильтры, сохранение пресетов.

Карточка участника:
- Профиль, история голосований, динамика оценок, участие в сессиях, примечания.

---

## 8. Голоса и корректировки (веб)

- Просмотр матрицы голоса: кто кого оценил, значения, время.
- Поисковые фильтры: по сессии, оценщику, оцениваемому, диапазону оценок, времени.
- Корректировки админом: PATCH score, DELETE голос, пометка modified_by_admin.
- Автоперерасчёт T2–T4, кнопка «Пересчитать» вручную.

Журнал изменений:
- Каждая правка голосов логируется (кто, что, когда, почему).

---

## 9. Параметры премии (веб)

- Форма редактирования параметров на уровне сессии.
- Подсказки и валидация диапазонов.
- История изменений с привязкой к администратору и отметкой времени.
- Что влияет на расчёт отображается tooltips, ссылка на «Методологию расчёта».

---

## 10. Отчёты и экспорт (веб)

- Экспорт: XLSX/CSV/JSON по сессии и по периоду.
- Конструктор отчётов: выбор полей (ФИО, username, отдел, средние, ранги, премии, детализация голосов, T1–T4 — опционально).
- Шаблоны экспорта, сохранение настроек.
- Планирование экспорта (отправка по email/в Webhook).

---

## 11. Журнал и мониторинг (веб)

- Лента событий: фильтр по user/session/type/date.
- Деталка события с payload.
- Мониторинг активности: графики команд бота, частоты входов, скорость заполнения голосов.
- Алерты: триггеры на низкую активность/аномалии.

---

## 12. Настройки системы (веб)

- Глобальные параметры: шкала оценок, self_vote_weight, min_votes_required, session_duration_days.
- Интеграции: Telegram Bot, Webhook URL, email SMTP.
- Безопасность: роли и права, лимиты запросов, политика хранения данных.
- Темизация UI (светлая/тёмная), локализация.

---

## 13. Веб-интерфейс сотрудника

- Мой дашборд: текущая сессия, статус голосования, быстрые действия.
- Экран голосования: список коллег, удобный ввод оценок, валидатор, autosave черновика.
- Мои результаты: рейтинг, динамика, сравнение с прошлой неделей.
- История: прошлые сессии, скачивание своих данных.

---

## 14. Связь с Telegram Bot

- Уведомления из бота содержат deep-link в веб (например, /sessions/18/vote).
- Веб при входе может привязать/проверить Telegram ID пользователя.
- Админ-операции в боте — укороченные сценарии, полная мощность — в веб.

---

## 15. Доступность и производительность

- WCAG-совместимость: контраст, клавиатурная навигация, ARIA.
- Оптимизация таблиц: серверная пагинация, ленивые запросы, агрегации на сервере.
- Предпросмотр экспорта без блокировки UI.

---

## 16. Каркас API → UI (примеры)

- GET /api/v1/sessions?status=active → список на странице «Сессии».
- GET /api/v1/sessions/{id}/votes → матрица голосов.
- PATCH /api/v1/votes/{vote_id} → модалка корректировки оценки.
- POST /api/v1/sessions/{id}/bonus-params → форма параметров премии.
- GET /api/v1/export/session/{id}?format=xlsx → кнопка «Экспорт».

---

## 17. MVP vs Расширенный функционал

MVP (веб):
- Список/детали сессии, голосование для сотрудников, мои результаты.
- Базовые админ-функции: создать/закрыть сессию, параметры премии, экспорт.

Расширенный (приоритет админ):
- Мастер создания сессий, матрица голосов, массовые операции с участниками.
- Глубокие отчёты, конструктор экспорта, журнал с фильтрами, мониторинг.
- Роли manager/auditor, архив сессий с поиском, алерты.

---

## 18. Навигационные сценарии администратора (пример)

1) Дашборд → «Создать сессию» → Мастер (3 шага) → «Создать и уведомить».
2) Сессии → №18 → Вкладка «Голоса» → Фильтр оценок <3 → Корректировка → Пересчёт.
3) Участники → Фильтр «в отпуске» → Массово исключить из сессии → Сохранить.
4) Результаты → Экспорт XLSX (с деталями голосов) → Отправить бухгалтерии.
5) Журнал → Фильтр по admin_id → Проверить историю изменений → Экспорт в CSV.

---

## 19. Безопасность админ-операций

- Все критические действия логируются с IP/UA/временем и причиной.
- Двухшаговое подтверждение для удаления/массовых изменений.
- Ролевые ограничения и видимость данных по принципу наименьших прав.

---

## 20. Совместное использование

- Ссылки на отчёты можно шарить в пределах организации (с проверкой доступа).
- Экспортируемые файлы помечаются версией и временем генерации.

---

Этот раздел дополняет Telegram Bot, обеспечивая удобную веб-панель с расширенным функционалом для администраторов и продвинутых сценариев анализа и управления.
